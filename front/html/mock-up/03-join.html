<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- 퍼블용 include: 개발팀에서 재include 하길 바랍니다. -->
    <script class="__include" src="../include/meta.js"></script>

    <title>끌</title>

    <!-- 퍼블용 include: 개발팀에서 재include 하길 바랍니다. -->
    <script class="__include" src="../include/head.js"></script>

    <script>
      ui.Common.title('회원가입');
    </script>
  </head>
  <body>
    <article id="wrap">
      <!-- 헤더 -->
      <header id="header">
        <div>
          <div class="head-left">
            <button class="head-back button" aria-label="이전화면"></button>
          </div>
        </div>
      </header>
      <!-- //헤더 -->

      <!-- 컨테이너(컨텐츠) -->
      <main id="container">
        <div class="section">
          <h1 class="tit-h1">이름을 입력해 주세요</h1>
          <h1 class="tit-h1" style="display: none">주민등록번호를 입력해 주세요</h1>
          <h1 class="tit-h1" style="display: none">통신사를 선택해 주세요</h1>
          <h1 class="tit-h1" style="display: none">휴대폰 번호를 입력해주세요</h1>
          <!-- <h2 class="_keycode"></h2> -->

          <div class="input line-lbl-inp mt-30" data-step="3" style="display: none">
            <input type="tel" id="input4" title="휴대폰번호입력" placeholder="휴대폰 번호" maxlength="13" />
            <label for="input4" class="lbl">휴대폰 번호</label>
          </div>

          <div class="select line-lbl-inp mt-30" data-step="2" style="display: none">
            <select id="select3" title="통신사선택" class="off">
              <option value="">통신사선택</option>
              <option value="1">SKT</option>
              <option value="2">KT</option>
              <option value="3">LG U+</option>
              <option value="4">SKT 알뜰폰</option>
              <option value="5">KT 알뜰폰</option>
              <option value="6">LG U+ 알뜰폰</option>
            </select>
            <div class="lbl">통신사선택</div>
          </div>

          <div class="input line-lbl-inp mt-30" data-step="1" style="display: none">
            <input type="tel" id="input2-1" class="no-del" title="주민등록번호 앞자리 입력" placeholder="주민등록번호" maxlength="6" />
            <div class="dash">-</div>
            <input type="tel" id="input2-2" class="no-del w-40f t_center" title="주민등록번호 뒷자리 입력" placeholder="주민등록번호" maxlength="1" />
            <label for="input2-2" class="masking" aria-hidden="true">●●●●●●</label>
            <label for="input2-1" class="lbl">주민등록번호</label>
          </div>

          <div class="input line-lbl-inp mt-30" data-step="0">
            <input type="text" id="input1" title="이름입력" placeholder="이름" maxlength="10" />
            <label for="input1" class="lbl">이름</label>
          </div>
        </div>

        <div class="btn-wrap bottom-fixed focus-btn" style="display: none">
          <div class="flex">
            <button type="button" id="btnFocus" class="button h60 primary" disabled>확인</button>
          </div>
        </div>

        <div class="btn-wrap bottom-fixed next-btn">
          <div class="flex">
            <button type="button" id="btnNext" class="button h60 primary" disabled>본인인증하기</button>
          </div>
        </div>
      </main>
      <!-- 컨테이너(컨텐츠) -->

      <!-- 팝업 -->
      <div id="pop-agree" class="popup bottom" role="dialog" aria-hidden="true">
        <article class="pop-wrap">
          <div class="pop-head">
            <div>
              <h1>모두 동의하기</h1>
              <!-- <button type="button" class="pop-close ui-pop-close" aria-label="팝업창 닫기"></button> -->
            </div>
          </div>
          <div class="pop-body">
            <div class="section">
              <div class="agree-dl ui-agree">
                <div class="agree-dt">
                  <div class="checkbox">
                    <input type="checkbox" id="agreeAll1" class="ui-all-agree-chk" /><i aria-hidden="true"></i>
                    <label class="lbl fz-16 fc-424242" for="agreeAll1"><strong>전체 동의</strong></label>
                  </div>
                </div>
                <div class="agree-dd">
                  <div class="checkbox ty2">
                    <input type="checkbox" id="agree1-1" class="ui-agree-chk" /><i aria-hidden="true"></i>
                    <div class="lbl">
                      <label for="agree1-1" class="fc-primary">(필수) 서비스 약관동의</label>
                      <a href="#" class="agree-btn" data-agree-pdf="../../temp/교보증권마이데이터 샘플.pdf" aria-label="약관상세 확인"><i class="i-ico-agree-arrow" aria-hidden="true"></i></a>
                    </div>
                  </div>
                  <div class="checkbox ty2">
                    <input type="checkbox" id="agree1-2" class="ui-agree-chk" /><i aria-hidden="true"></i>
                    <div class="lbl">
                      <label for="agree1-2">(필수) 본인확인 동의</label>
                      <a href="#" class="agree-btn" aria-label="약관상세 확인"><i class="i-ico-agree-arrow" aria-hidden="true"></i></a>
                    </div>
                  </div>
                  <div class="checkbox ty2">
                    <input type="checkbox" id="agree1-3" class="ui-agree-chk" data-agree-target="#agree1-3-kakao, #agree1-3-sms, #agree1-3-mail" /><i aria-hidden="true"></i>
                    <div class="lbl">
                      <label for="agree1-3">(선택) 마케팅 정보 제공 및 활용 동의</label>
                      <a href="#" class="agree-btn" aria-label="약관상세 확인"><i class="i-ico-agree-arrow" aria-hidden="true"></i></a>
                    </div>
                  </div>
                  <div class="mt-14 pl-28">
                    <span class="checkbox ty2">
                      <input type="checkbox" id="agree1-3-kakao" /><i aria-hidden="true"></i>
                      <label for="agree1-3-kakao" class="lbl fz-14">카카오톡 수신</label>
                    </span>
                    <span class="checkbox ty2">
                      <input type="checkbox" id="agree1-3-sms" /><i aria-hidden="true"></i>
                      <label for="agree1-3-sms" class="lbl fz-14">문자 수신</label>
                    </span>
                    <span class="checkbox ty2">
                      <input type="checkbox" id="agree1-3-mail" /><i aria-hidden="true"></i>
                      <label for="agree1-3-mail" class="lbl fz-14">메일 수신</label>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="pop-foot">
            <div>
              <div class="flex">
                <button type="button" id="btnAgree" class="button primary" disabled>동의하고 진행</button>
              </div>
            </div>
          </div>
        </article>
      </div>

      <!-- //팝업 -->
    </article>

    <script src="../../js/mockup.js"></script>
    <script>
      let _step = 0;
      let _lastStep = 4;
      let blurTime;
      function reset() {
        blurTime = setTimeout(function () {
          $('.focus-btn').hide();
          $('.next-btn').show();
          $('#btnFocus').prop('disabled', true);
          $('.__ing').removeClass('__ing');
        }, 100);
      }
      function nextStep() {
        const $focus = $('.__ing');
        const $step = $focus.closest('[data-step]');
        const $stepVal = parseInt($step.data('step'));
        if (_step === $stepVal) {
          _step += 1;
          $('.tit-h1').eq(_step).show().siblings('.tit-h1').hide();
          $('[data-step=' + _step + ']').slideDown(300, function () {
            if (_step === 2) {
              $('.btn-select').focus().click();
            } else {
              $(this).find(':focusable').first().focus();
            }
          });
          if (_step >= _lastStep) {
            reset();
            $('#btnNext').prop('disabled', false);
            setTimeout(function () {
              $('#btnNext').focus();
            }, 500);
          }
        }
      }
      function phoneFormatter(val) {
        const cleanInput = val.replaceAll(/[^0-9]/g, '');
        let result = '';
        const length = cleanInput.length;
        if (length === 8) {
          result = cleanInput.replace(/(\d{4})(\d{4})/, '$1-$2');
        } else if (cleanInput.startsWith('02') && (length === 9 || length === 10)) {
          result = cleanInput.replace(/(\d{2})(\d{3,4})(\d{4})/, '$1-$2-$3');
        } else if (!cleanInput.startsWith('02') && (length === 10 || length === 11)) {
          result = cleanInput.replace(/(\d{3})(\d{3,4})(\d{4})/, '$1-$2-$3');
        } else {
          result = cleanInput;
        }
        return result;
      }

      $('.input input').focus(function () {
        clearTimeout(blurTime);
        const $this = $(this);
        const $value = $this.val();
        $('.focus-btn').show();
        $('.next-btn').hide();
        $('.__ing').removeClass('__ing');
        $this.addClass('__ing');

        if ($value) $('#btnFocus').prop('disabled', false);
        else $('#btnFocus').prop('disabled', true);
      });

      $('.input input').keyup(function (e) {
        const $keyCode = e.keyCode ? e.keyCode : e.which;
        const $this = $(this);
        const $id = $this.attr('id');
        const $maxlength = parseInt($this.attr('maxlength'));
        const $value = $this.val();
        if ($id === 'input1' && $value.length < 2) {
          $('#btnFocus').prop('disabled', true);
          return;
        }
        if ($id === 'input2-1') {
          if ($value.length >= $maxlength) $('#input2-2').focus();
          else $('#btnFocus').prop('disabled', true);
          return;
        }
        if ($id === 'input2-2') {
          if ($value.length && $('#input2-1').val().length === 6) {
            reset();
            nextStep();
          } else {
            return;
          }
        }

        if ($id === 'input4') {
          $this.val(phoneFormatter($value));
          if ($this.val().length >= $maxlength) {
            reset();
            nextStep();
          }
        }
        if ($value) $('#btnFocus').prop('disabled', false);
        else $('#btnFocus').prop('disabled', true);

        if ($keyCode === 13) {
          e.preventDefault();
          reset();
          nextStep();
        }
        $('._keycode').html($keyCode);
      });

      $('#select3').change(function () {
        const $this = $(this);
        const $val = $this.val();
        $this.addClass('__ing');
        if ($val) nextStep();
      });

      $('.input input').blur(reset);
      $('#btnFocus').click(function () {
        nextStep();
      });
      $('#btnNext').click(function () {
        Layer.open('#pop-agree');
      });

      $('#agree1-1, agree1-2').change(function () {
        const _val1 = $('#agree1-1').prop('checked');
        const _val2 = $('#agree1-2').prop('checked');
        if (_val1 && _val2) {
          $('#btnAgree').prop('disabled', false);
        } else {
          $('#btnAgree').prop('disabled', true);
        }
      });

      $('#btnAgree').click(function () {
        Layer.alert('다음스텝 현재 없음');
      });
    </script>
  </body>
</html>
