<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover" />
    <link rel="shortcut icon" type="image/x-icon" href="../../images/favicon.png" />
    <meta property="og:image" content="https://dev-mydata.mykkl.com/mydata/resources/static/images/og_image_1200x630.png" />
    <title>끌</title>
    <link href="../../css/front.min.css" rel="stylesheet" />
    <script type="text/javascript" src="../../js/lib/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="../../js/lib/lodash.min.js"></script>
    <script type="text/javascript" src="../../js/ui-plugins.min.js"></script>
    <script type="text/javascript" src="../../js/ui-front.js"></script>
    <script>
      ui.Common.title('테스트');
    </script>
    <style>
      .checkbox .num {
        background: var(--primary-color);
        color: #fff;
        border-radius: 50%;
        text-align: center;
        font-weight: bold;
        z-index: 2;
      }
      .checkbox .num:after {
        content: none;
      }
    </style>
  </head>
  <body>
    <article id="wrap">
      <!-- 헤더 -->
      <header id="header">
        <div>
          <div class="head-left">
            <button type="button" class="head-back button" aria-label="이전화면"></button>
          </div>
          <h1></h1>
        </div>
      </header>
      <!-- //헤더 -->

      <!-- 컨테이너(컨텐츠) -->
      <main id="container">
        <div class="section">
          <ul>
            <li>
              <a href="#" class="flex space-between btn-click">
                <span>안효주</span>
                <span>천재</span>
              </a>
            </li>
          </ul>
          <h1 class="gd__h1">체크박스 넘버링</h1>
          <div class="flex align-center">
            <label class="checkbox">
              <input type="checkbox" class="all-chk" value="all" /><i aria-hidden="true"></i>
              <div class="lbl">전체선택</div>
            </label>
            <div class="input line">
              <input type="tel" class="chk-num" placeholder="전체 체크할 수" value="5" />
            </div>
          </div>
          <div class="step-cont-bottom mt-10">
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="1" /><i aria-hidden="true"></i>
                <div class="lbl">선택1</div>
              </label>
            </div>
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="2" /><i aria-hidden="true"></i>
                <div class="lbl">선택2</div>
              </label>
            </div>
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="3" /><i aria-hidden="true"></i>
                <div class="lbl">선택3</div>
              </label>
            </div>
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="4" /><i aria-hidden="true"></i>
                <div class="lbl">선택4</div>
              </label>
            </div>
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="5" /><i aria-hidden="true"></i>
                <div class="lbl">선택5</div>
              </label>
            </div>
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="6" /><i aria-hidden="true"></i>
                <div class="lbl">선택6</div>
              </label>
            </div>
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="7" /><i aria-hidden="true"></i>
                <div class="lbl">선택7</div>
              </label>
            </div>
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="8" /><i aria-hidden="true"></i>
                <div class="lbl">선택8</div>
              </label>
            </div>
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="9" /><i aria-hidden="true"></i>
                <div class="lbl">선택9</div>
              </label>
            </div>
            <div class="chk-item ty2">
              <label class="checkbox">
                <input type="checkbox" value="a" /><i aria-hidden="true"></i>
                <div class="lbl">선택10</div>
              </label>
            </div>
          </div>
        </div>
      </main>
      <!-- 컨테이너(컨텐츠) -->
    </article>
    <script>
      let $chkAry = [];
      function aryChk(ary) {
        $('.step-cont-bottom .checkbox').find('.num').remove();
        $.each(ary, function (i) {
          const val = this[0];
          console.log(val);
          const $input = $('.step-cont-bottom .checkbox input[value=' + val + ']');
          const $checkbox = $input.closest('.checkbox');
          $checkbox.append('<i class="num">' + (i + 1) + '</i>');
        });
      }
      $('.step-cont-bottom .checkbox input').change(function () {
        const $checked = $(this).prop('checked');
        const $val = $(this).val();
        if ($checked) {
          $chkAry.push($val);
        } else {
          $chkAry = $chkAry.filter((item) => item !== $val);
        }
        aryChk($chkAry);
      });

      $('.all-chk').change(function () {
        // $chkAry = [];
        const $checked = $(this).prop('checked');
        const $chk = $('.step-cont-bottom .checkbox');
        // $chk.find('.num').remove();
        $chk.find('input:checked').each(function () {
          $(this).prop('checked', false).change();
        });

        $chk.each(function (i) {
          const $input = $(this).find('input');
          const $max = parseInt($('.chk-num').val());
          if ($checked) {
            if ($max) {
              if (i < $max) $input.prop('checked', true).change();
            } else {
              $input.prop('checked', true).change();
            }
          } else {
            $input.prop('checked', false).change();
          }
        });
      });
    </script>
  </body>
</html>
